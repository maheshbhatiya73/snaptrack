import{_ as T}from"./CXlwqJHU.js";import{c as d,o as i,a as e,g as h,t as l,d as b,n as w,z as V,F as B,y as j,r as v,p as R,e as N,f as U,q as L,s as M,x as W,b as H,w as E,A as I}from"#entry";import{i as q,j as O,k as G,l as J}from"./EuvIHkR0.js";import{_ as K}from"./DQgf2YDm.js";const Q={class:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden"},X={class:"p-6"},Y={class:"flex items-start justify-between mb-4"},Z={class:"flex-1"},D={class:"flex items-center space-x-3 mb-2"},ee={class:"text-lg font-semibold text-gray-900"},se={class:"text-sm text-gray-600"},te={class:"flex items-center space-x-3"},oe={class:"mb-4"},re={class:"flex items-center justify-between mb-2"},ne={class:"text-sm text-gray-500"},le={class:"w-full bg-gray-200 rounded-full h-2"},ie={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},ae={class:"space-y-1"},de={class:"text-sm font-semibold text-gray-900 capitalize"},ce={class:"space-y-1"},ue={class:"text-sm font-semibold text-gray-900 uppercase"},me={class:"space-y-1"},ge={class:"text-sm font-semibold text-gray-900"},fe={class:"space-y-1"},pe={class:"text-sm font-semibold text-gray-900"},xe={key:0,class:"mb-4"},ve={class:"text-sm text-gray-900 truncate"},be={class:"mb-4"},he={class:"text-sm text-gray-900"},ke={key:1,class:"mb-4"},ye={class:"text-sm text-gray-900"},we={key:2,class:"border-t border-gray-200 pt-4"},_e={class:"flex flex-wrap gap-2"},$e={key:0,class:"w-2 h-2 bg-green-500 rounded-full mr-2"},Ce={key:1,class:"w-2 h-2 bg-blue-500 rounded-full mr-2"},Me={__name:"BackupProcessCard",props:{process:{type:Object,required:!0}},setup(n){const k=o=>({pending:"bg-gray-100 text-gray-800",running:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",error:"bg-red-100 text-red-800"})[o]||"bg-gray-100 text-gray-800",y=o=>({pending:"Pending",running:"Running",completed:"Completed",failed:"Failed",error:"Error"})[o]||o,a=o=>({pending:"bg-gray-400",running:"bg-blue-500",completed:"bg-green-500",failed:"bg-red-500",error:"bg-red-500"})[o]||"bg-gray-400",m=o=>{if(!o||o===0)return"0 B";const t=1024,c=["B","KB","MB","GB","TB"],p=Math.floor(Math.log(o)/Math.log(t));return parseFloat((o/Math.pow(t,p)).toFixed(2))+" "+c[p]},x=o=>!o||o===0?"N/A":m(o)+"/s",g=o=>{if(o<60)return`${o}s`;if(o<3600)return`${Math.floor(o/60)}m ${o%60}s`;const t=Math.floor(o/3600),c=Math.floor(o%3600/60);return`${t}h ${c}m`};return(o,t)=>(i(),d("div",Q,[e("div",X,[e("div",Y,[e("div",Z,[e("div",D,[t[1]||(t[1]=e("div",{class:"w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})])],-1)),e("div",null,[e("h3",ee,l(n.process.backup?.name||`Backup #${n.process.backup_id}`),1),e("p",se,l(n.process.backup?.source||"Unknown source")+" â†’ "+l(n.process.backup?.destination||"Unknown destination"),1)])])]),e("div",te,[e("button",{onClick:t[0]||(t[0]=c=>o.$emit("remove",n.process.id)),class:"inline-flex items-center px-2 py-1 border border-red-300 rounded-md text-xs font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"},[...t[2]||(t[2]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),b(" Remove ",-1)])]),e("span",{class:w(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",k(n.process.status)])},l(y(n.process.status)),3)])]),e("div",oe,[e("div",re,[t[3]||(t[3]=e("span",{class:"text-sm font-medium text-gray-700"},"Progress",-1)),e("span",ne,l(n.process.progress)+"%",1)]),e("div",le,[e("div",{class:w(["h-2 rounded-full transition-all duration-300 ease-out",a(n.process.status)]),style:V({width:n.process.progress+"%"})},null,6)])]),e("div",ie,[e("div",ae,[t[4]||(t[4]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wide"},"Type",-1)),e("p",de,l(n.process.backup?.type||"Unknown"),1)]),e("div",ce,[t[5]||(t[5]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wide"},"File Type",-1)),e("p",ue,l(n.process.backup?.file_type||"Unknown"),1)]),e("div",me,[t[6]||(t[6]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wide"},"Size",-1)),e("p",ge,l(m(n.process.bytes_processed||0)),1)]),e("div",fe,[t[7]||(t[7]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wide"},"Speed",-1)),e("p",pe,l(x(n.process.speed_bps)),1)])]),n.process.current_file?(i(),d("div",xe,[t[8]||(t[8]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1"},"Current File",-1)),e("p",ve,l(n.process.current_file),1)])):h("",!0),e("div",be,[t[9]||(t[9]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1"},"Status",-1)),e("p",he,l(n.process.message),1)]),n.process.eta_seconds&&n.process.status==="running"?(i(),d("div",ke,[t[10]||(t[10]=e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1"},"Estimated Time Remaining",-1)),e("p",ye,l(g(n.process.eta_seconds)),1)])):h("",!0),n.process.backup?.servers&&n.process.backup.servers.length>0?(i(),d("div",we,[t[11]||(t[11]=e("div",{class:"flex items-center space-x-2 mb-3"},[e("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"})]),e("p",{class:"text-xs font-medium text-gray-500 uppercase tracking-wide"},"Target Servers")],-1)),e("div",_e,[(i(!0),d(B,null,j(n.process.backup.servers,c=>(i(),d("span",{key:c.id,class:"inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-800 border border-gray-200"},[c.type==="local"?(i(),d("span",$e)):(i(),d("span",Ce)),b(" "+l(c.name),1)]))),128))])])):h("",!0)])]))}},Be={class:"min-h-screen bg-white"},je={class:"bg-white border-b border-gray-200"},Se={class:"px-8 py-6"},Fe={class:"flex items-center justify-between"},Ae={class:"flex space-x-3"},Pe=["disabled"],ze=["disabled"],Te={class:"px-8 py-8"},Ve={key:0,class:"flex items-center justify-center py-20"},Re={key:1,class:"bg-white border border-red-200 rounded-lg p-6 mb-8"},Ne={class:"flex items-start"},Ue={class:"ml-4"},Le={class:"text-gray-600 mt-2"},We={key:2},He={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},Ee={class:"bg-white border border-gray-200 rounded-lg p-6"},Ie={class:"flex items-center"},qe={class:"ml-4"},Oe={class:"text-2xl font-bold text-gray-900"},Ge={class:"bg-white border border-gray-200 rounded-lg p-6"},Je={class:"flex items-center"},Ke={class:"ml-4"},Qe={class:"text-2xl font-bold text-gray-900"},Xe={class:"bg-white border border-gray-200 rounded-lg p-6"},Ye={class:"flex items-center"},Ze={class:"ml-4"},De={class:"text-2xl font-bold text-gray-900"},es={class:"bg-white border border-gray-200 rounded-lg p-6"},ss={class:"flex items-center"},ts={class:"ml-4"},os={class:"text-2xl font-bold text-gray-900"},rs={key:0,class:"text-center py-20"},ns={key:1,class:"space-y-6"},cs={__name:"processes",setup(n){const k=U(),y=I(),a=v([]),m=v(!1),x=v(null);let g=null;const o=v(!1),t=v(""),c=v(null),p=R(()=>{const r={running:0,completed:0,failed:0,pending:0};return a.value.forEach(s=>{s.status==="running"?r.running++:s.status==="completed"?r.completed++:s.status==="failed"?r.failed++:s.status==="pending"&&r.pending++}),r}),_=async()=>{try{m.value=!0,x.value=null,a.value=await O()||[]}catch(r){x.value=r.message,console.error("Failed to load processes:",r)}finally{m.value=!1}},$=()=>{_()},S=()=>{t.value="Are you sure you want to remove all backup processes? This action cannot be undone.",c.value=async()=>{try{await G(),a.value=[],o.value=!1}catch(r){console.error("Failed to remove all processes:",r),alert("Failed to remove all processes: "+r.message),o.value=!1}},o.value=!0},F=r=>{t.value="Are you sure you want to remove this backup process?",c.value=async()=>{try{await J(r);const s=a.value.findIndex(u=>u.id===r);s>=0&&a.value.splice(s,1),o.value=!1}catch(s){console.error("Failed to remove process:",s),alert("Failed to remove process: "+s.message),o.value=!1}},o.value=!0},A=()=>{c.value&&c.value()},P=()=>{o.value=!1,c.value=null},C=()=>{try{const s=y.public.backendUrl.replace(/^http/,"ws")+"/ws/backups";g=new WebSocket(s),g.onopen=()=>{console.log("WebSocket connected for backup processes")},g.onmessage=u=>{try{const f=JSON.parse(u.data);z(f)}catch(f){console.error("Failed to parse WebSocket message:",f)}},g.onclose=()=>{console.log("WebSocket disconnected"),setTimeout(C,5e3)},g.onerror=u=>{console.error("WebSocket error:",u)}}catch(r){console.error("Failed to connect WebSocket:",r)}},z=r=>{const s=a.value.findIndex(u=>u.backup_id===r.backup_id);s>=0?a.value[s]={...a.value[s],...r,backup:{...r.backup,servers:r.servers}}:a.value.unshift({...r,backup:{...r.backup,servers:r.servers}}),r.status==="completed"&&setTimeout(()=>{const u=a.value.findIndex(f=>f.id===r.id);u>=0&&a.value.splice(u,1)},1e4)};return N(()=>{if(!q()){k.push("/auth/login");return}_(),C()}),L(()=>{g&&g.close()}),(r,s)=>{const u=T;return i(),d("div",Be,[e("div",je,[e("div",Se,[e("div",Fe,[s[2]||(s[2]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Backup Processes"),e("p",{class:"mt-2 text-gray-600"},"Monitor running backup operations in real-time")],-1)),e("div",Ae,[e("button",{onClick:S,disabled:m.value||a.value.length===0,class:"inline-flex items-center px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},[...s[0]||(s[0]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),b(" Remove All ",-1)])],8,Pe),e("button",{onClick:$,disabled:m.value,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[(i(),d("svg",{class:w(["w-4 h-4 mr-2",{"animate-spin":m.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...s[1]||(s[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),b(" "+l(m.value?"Refreshing...":"Refresh"),1)],8,ze)])])])]),e("main",Te,[m.value&&a.value.length===0?(i(),d("div",Ve,[...s[3]||(s[3]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"}),e("p",{class:"mt-6 text-lg text-gray-600 font-medium"},"Loading backup processes...")],-1)])])):x.value?(i(),d("div",Re,[e("div",Ne,[s[5]||(s[5]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Ue,[s[4]||(s[4]=e("h3",{class:"text-lg font-semibold text-red-800"},"Error loading processes",-1)),e("p",Le,l(x.value),1),e("button",{onClick:$,class:"mt-4 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Try Again ")])])])):(i(),d("div",We,[e("div",He,[e("div",Ee,[e("div",Ie,[s[7]||(s[7]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])])],-1)),e("div",qe,[s[6]||(s[6]=e("p",{class:"text-sm font-medium text-gray-500"},"Running",-1)),e("p",Oe,l(p.value.running),1)])])]),e("div",Ge,[e("div",Je,[s[9]||(s[9]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1)),e("div",Ke,[s[8]||(s[8]=e("p",{class:"text-sm font-medium text-gray-500"},"Completed",-1)),e("p",Qe,l(p.value.completed),1)])])]),e("div",Xe,[e("div",Ye,[s[11]||(s[11]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1)),e("div",Ze,[s[10]||(s[10]=e("p",{class:"text-sm font-medium text-gray-500"},"Failed",-1)),e("p",De,l(p.value.failed),1)])])]),e("div",es,[e("div",ss,[s[13]||(s[13]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1)),e("div",ts,[s[12]||(s[12]=e("p",{class:"text-sm font-medium text-gray-500"},"Pending",-1)),e("p",os,l(p.value.pending),1)])])])]),a.value.length===0?(i(),d("div",rs,[s[15]||(s[15]=W('<div class="w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-6"><svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div><h3 class="text-2xl font-bold text-gray-900 mb-3">No backup processes running</h3><p class="text-gray-500 mb-8 max-w-md mx-auto">Start a backup to see real-time progress monitoring here</p>',3)),H(u,{to:"/backup",class:"inline-flex items-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},{default:E(()=>[...s[14]||(s[14]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),b(" Start Backup ",-1)])]),_:1})])):(i(),d("div",ns,[(i(!0),d(B,null,j(a.value,f=>(i(),M(Me,{key:f.id,process:f,onRemove:F},null,8,["process"]))),128))]))]))]),o.value?(i(),M(K,{key:0,message:t.value,onConfirm:A,onCancel:P},null,8,["message"])):h("",!0)])}}};export{cs as default};
