import{r as d,h as O,p as b,e as H,f as U,q as W,c as l,a as e,d as F,n as y,t as r,k,v as $,l as V,x as q,F as P,y as J,o as i,j as Q}from"#entry";import{i as Y,f as G,v as K}from"./EuvIHkR0.js";const X={class:"min-h-screen bg-white"},Z={class:"bg-white border-b border-gray-200"},ee={class:"px-8 py-6"},te={class:"flex items-center justify-between"},se={class:"flex space-x-3"},oe=["disabled"],re={key:0,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ne={key:1,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},le={class:"px-8 py-8"},ie={key:0,class:"flex items-center justify-center py-20"},ae={key:1,class:"bg-white border border-red-200 rounded-lg p-6 mb-8"},de={class:"flex items-start"},ue={class:"ml-4"},ce={class:"text-gray-600 mt-2"},ve={key:2},ge={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},me={class:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow"},fe={class:"flex items-center"},he={class:"ml-4"},xe={class:"text-2xl font-bold text-green-600"},pe={class:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow"},be={class:"flex items-center"},ye={class:"ml-4"},we={class:"text-2xl font-bold text-red-600"},ke={class:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow"},_e={class:"flex items-center"},Ce={class:"ml-4"},Me={class:"text-2xl font-bold text-blue-600"},Se={class:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow"},Be={class:"flex items-center"},je={class:"ml-4"},Ae={class:"text-2xl font-bold text-gray-900"},Le={class:"mb-8 flex items-center space-x-4"},Fe={class:"relative flex-1 max-w-md"},Ve={key:0,class:"text-center py-20"},Re={key:1,class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"},De=["onClick"],Ee={class:"flex items-start justify-between"},Ne={class:"text-lg font-semibold text-gray-900"},Te={class:"text-sm text-gray-500"},ze={class:"flex items-center space-x-3"},Ie=["onClick"],Oe={viewBox:"0 0 48 48",class:"w-12 h-12"},He=["stroke","stroke-dashoffset"],Ue={class:"absolute inset-0 flex items-center justify-center"},We={class:"text-xs font-semibold text-gray-900"},$e={class:"mt-4 grid grid-cols-3 gap-4 text-sm"},qe={class:"font-medium"},Pe={class:"font-medium"},Ge={__name:"index",setup(Je){const _=U(),a=d([]),u=d(!1),g=d(null),m=d(""),f=d(""),h=d(""),w=d(null),c=d(!1),C=O({});let n=null;const x=2*Math.PI*18,M=b(()=>{let s=a.value;if(m.value){const t=m.value.toLowerCase();s=s.filter(o=>o.name&&o.name.toLowerCase().includes(t)||o.host&&o.host.toLowerCase().includes(t)||o.ssh_user&&o.ssh_user.toLowerCase().includes(t))}if(f.value&&(s=s.filter(t=>t.type===f.value)),h.value){const t=h.value==="enabled";s=s.filter(o=>o.enabled===t)}return s}),R=b(()=>a.value.filter(s=>s.enabled).length),D=b(()=>a.value.filter(s=>!s.enabled).length),E=b(()=>a.value.filter(s=>s.type==="remote").length),N=s=>{if(!s)return"—";try{return new Date(s).toLocaleString()}catch{return"—"}},p=s=>{const t=C[s]?.cpu_percent;return t==null?null:Math.max(0,Math.min(100,Number(t)))},T=s=>s==null?x:x-x*s/100,z=s=>s==null?"#9CA3AF":s>85?"#EF4444":s>65?"#F59E0B":"#10B981",S=async()=>{try{u.value=!0,g.value=null;const s=await G();a.value=s.servers||s||[],s.server_statuses&&(a.value=a.value.map(t=>({...t,connection_status:s.server_statuses[t.id]||"unknown",last_checked:s.server_statuses[t.id]?new Date().toISOString():t.last_checked})))}catch(s){g.value=s.message,console.error("Failed to load servers:",s)}finally{u.value=!1}},B=()=>{if(n){try{n.close()}catch{}n=null}const s=K();console.debug("[monitor] connecting ws",s),n=new WebSocket(s),n.onmessage=t=>{try{const o=JSON.parse(t.data);if(Array.isArray(o))for(const v of o)v&&v.server_id!=null&&(C[v.server_id]=v)}catch{}},n.onopen=()=>{console.debug("[monitor] ws connected")},n.onerror=t=>{console.warn("[monitor] ws error",t)},n.onclose=()=>{console.debug("[monitor] ws closed, retrying in 3s"),n=null,setTimeout(()=>{n||B()},3e3)}},j=()=>{S()},A=()=>{w.value&&(clearInterval(w.value),w.value=null)},I=()=>{c.value=!c.value,c.value||A()},L=s=>{_.push(`/monitor/${s.id}`)};return H(()=>{if(!Y()){_.push("/auth/login");return}S(),B()}),W(()=>{if(A(),n)try{n.close()}catch{}}),(s,t)=>(i(),l("div",X,[e("div",Z,[e("div",ee,[e("div",te,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Monitor"),e("p",{class:"mt-2 text-gray-600"},"Live metrics for your backup servers")],-1)),e("div",se,[e("button",{onClick:j,disabled:u.value,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[(i(),l("svg",{class:y(["w-4 h-4 mr-2",{"animate-spin":u.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[3]||(t[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),F(" "+r(u.value?"Refreshing...":"Refresh"),1)],8,oe),e("button",{onClick:I,class:y(["inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white",c.value?"bg-gray-900 hover:bg-gray-800 focus:ring-gray-500":"bg-gray-500 hover:bg-gray-600 focus:ring-gray-400"])},[c.value?(i(),l("svg",re,[...t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(i(),l("svg",ne,[...t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"},null,-1)])])),F(" "+r(c.value?"Auto-refresh On":"Auto-refresh Off"),1)],2)])])])]),e("main",le,[u.value&&a.value.length===0?(i(),l("div",ie,[...t[7]||(t[7]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"}),e("p",{class:"mt-6 text-lg text-gray-600 font-medium"},"Loading servers...")],-1)])])):g.value?(i(),l("div",ae,[e("div",de,[t[9]||(t[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",ue,[t[8]||(t[8]=e("h3",{class:"text-lg font-semibold text-red-800"},"Error loading servers",-1)),e("p",ce,r(g.value),1),e("button",{onClick:j,class:"mt-4 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Try Again ")])])])):(i(),l("div",ve,[e("div",ge,[e("div",me,[e("div",fe,[t[11]||(t[11]=e("div",{class:"p-3 bg-green-100 rounded-lg"},[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",he,[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-600"},"Active Servers",-1)),e("p",xe,r(R.value),1)])])]),e("div",pe,[e("div",be,[t[13]||(t[13]=e("div",{class:"p-3 bg-red-100 rounded-lg"},[e("svg",{class:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",ye,[t[12]||(t[12]=e("p",{class:"text-sm font-medium text-gray-600"},"Inactive Servers",-1)),e("p",we,r(D.value),1)])])]),e("div",ke,[e("div",_e,[t[15]||(t[15]=e("div",{class:"p-3 bg-blue-100 rounded-lg"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"})])],-1)),e("div",Ce,[t[14]||(t[14]=e("p",{class:"text-sm font-medium text-gray-600"},"Remote Servers",-1)),e("p",Me,r(E.value),1)])])]),e("div",Se,[e("div",Be,[t[17]||(t[17]=e("div",{class:"p-3 bg-gray-100 rounded-lg"},[e("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])],-1)),e("div",je,[t[16]||(t[16]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Servers",-1)),e("p",Ae,r(a.value.length),1)])])])]),e("div",Le,[e("div",Fe,[k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>m.value=o),type:"text",placeholder:"Search servers...",class:"w-full px-3 py-2 pl-10 border border-gray-300 rounded-md bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[$,m.value]]),t[18]||(t[18]=e("svg",{class:"w-4 h-4 absolute left-3 top-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),k(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o),class:"w-40 px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...t[19]||(t[19]=[e("option",{value:""},"All Types",-1),e("option",{value:"remote"},"Remote",-1),e("option",{value:"local"},"Local",-1)])],512),[[V,f.value]]),k(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>h.value=o),class:"w-40 px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...t[20]||(t[20]=[e("option",{value:""},"All Status",-1),e("option",{value:"enabled"},"Enabled",-1),e("option",{value:"disabled"},"Disabled",-1)])],512),[[V,h.value]])]),M.value.length===0?(i(),l("div",Ve,[...t[21]||(t[21]=[q('<div class="w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-6"><svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg></div><h3 class="text-2xl font-bold text-gray-900 mb-3">No servers found</h3><p class="text-gray-500 mb-8 max-w-md mx-auto">Add servers on the Servers page to monitor metrics</p>',3)])])):(i(),l("div",Re,[(i(!0),l(P,null,J(M.value,o=>(i(),l("div",{key:o.id,class:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:v=>L(o)},[e("div",Ee,[e("div",null,[e("div",Ne,r(o.name),1),e("div",Te,r(o.host),1)]),e("div",ze,[e("span",{class:y(["px-2 py-1 rounded text-xs",o.type==="remote"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"])},r(o.type),3),e("div",{class:"relative w-12 h-12",onClick:Q(v=>L(o),["stop"])},[(i(),l("svg",Oe,[t[22]||(t[22]=e("circle",{cx:"24",cy:"24",r:"18",class:"text-gray-200",stroke:"currentColor","stroke-width":"6",fill:"transparent"},null,-1)),e("circle",{cx:"24",cy:"24",r:"18",stroke:z(p(o.id)),"stroke-width":"6",fill:"transparent","stroke-linecap":"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"},"stroke-dasharray":x,"stroke-dashoffset":T(p(o.id))},null,8,He)])),e("div",Ue,[e("span",We,r(p(o.id)!=null?p(o.id).toFixed(0)+"%":"—"),1)])],8,Ie)])]),e("div",$e,[e("div",null,[t[23]||(t[23]=e("div",{class:"text-xs text-gray-500"},"Status",-1)),e("div",{class:y(["font-medium",(o.connection_status||"unknown")==="connected"?"text-green-600":"text-gray-700"])},r(o.connection_status||"unknown"),3)]),e("div",null,[t[24]||(t[24]=e("div",{class:"text-xs text-gray-500"},"Enabled",-1)),e("div",qe,r(o.enabled?"Yes":"No"),1)]),e("div",null,[t[25]||(t[25]=e("div",{class:"text-xs text-gray-500"},"Last Checked",-1)),e("div",Pe,r(N(o.last_checked)),1)])]),t[26]||(t[26]=e("div",{class:"mt-6"},[e("button",{class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"}," View Monitor ")],-1))],8,De))),128))]))]))])]))}};export{Ge as default};
